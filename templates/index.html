<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIPSneaker Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #3390ec;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f4f4f5;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 15px; background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color); }
        .header { text-align: center; margin-bottom: 20px; }
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .product-card { background-color: var(--tg-theme-secondary-bg-color); border-radius: 12px; overflow: hidden; text-align: center; padding: 10px; }
        .product-card a { text-decoration: none; color: inherit; }
        .product-image { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        .product-name { font-weight: 600; font-size: 14px; margin-bottom: 5px; height: 40px; overflow: hidden; }
        .product-price { font-size: 16px; font-weight: 700; color: var(--tg-theme-link-color); }
        #cart-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        #cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #E53935;
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>VIPSneaker Shop</h1>
        <p style="color: var(--tg-theme-hint-color);">–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –≤–µ—â–µ–π</p>
    </div>

    <!-- <<< –ò–ö–û–ù–ö–ê –ö–û–†–ó–ò–ù–´ >>> -->
    <a href="/cart?user_id={{ user_id }}" id="cart-icon">
        üõí
        <span id="cart-count">0</span>
    </a>

    <div class="product-grid">
        {% for product in products %}
        <div class="product-card">
            <a href="/product/{{ product.id }}?user_id={{ user_id }}">
                <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image">
                <div class="product-name">{{ product.name }}</div>
                <div class="product-price">{{ product.price }} —Ä—É–±.</div>
            </a>
        </div>
        {% endfor %}
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        // <<< –°–ö–†–ò–ü–¢ –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ß–ï–¢–ß–ò–ö–ê >>>
        function updateCartCount() {
            try {
                const cart = JSON.parse(localStorage.getItem('cart')) || {};
                const count = Object.keys(cart).length; // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                const countElement = document.getElementById('cart-count');
                countElement.textContent = count;
                countElement.style.display = count > 0 ? 'flex' : 'none';
            } catch (e) {
                console.error("Could not update cart count:", e);
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –∫–Ω–æ–ø–∫–µ "–Ω–∞–∑–∞–¥")
        window.addEventListener('pageshow', updateCartCount);
        // –í—ã–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã —Å—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–∏–ª—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        updateCartCount();

    </script>
</body>
</html>