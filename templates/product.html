<!-- templates/product.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{{ product.name }} - VibesResell</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #3390ec;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f4f4f5;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; margin: 0; padding: 0 0 100px 0; /* Добавлен отступ снизу */ background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color); }
        .product-image { width: 100%; height: auto; max-height: 50vh; object-fit: contain; background-color: var(--tg-theme-secondary-bg-color); }
        .product-details { padding: 20px; }
        .product-name { font-size: 24px; font-weight: 700; margin-bottom: 10px; }
        .product-meta { margin-bottom: 15px; color: var(--tg-theme-hint-color); display: flex; gap: 15px; }
        .product-price { color: var(--tg-theme-text-color); font-size: 28px; font-weight: bold; margin-bottom: 15px; }
        .product-description { margin-bottom: 20px; line-height: 1.6; }

        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.8);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-top: 1px solid var(--tg-theme-secondary-bg-color);
            z-index: 100;
        }
        .btn-add-cart {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            text-align: center;
            text-decoration: none;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .btn-add-cart.added {
            background-color: #28a745; /* Зеленый цвет успеха */
        }
    </style>
</head>
<body>

    <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image">

    <div class="product-details">
        <h1 class="product-name">{{ product.name }}</h1>
        <div class="product-meta">
            <span><strong>Бренд:</strong> {{ product.brand }}</span>
            <span><strong>Размер:</strong> {{ product.size }}</span>
        </div>
        <div class="product-price">{{ product.price }} руб.</div>

        <!-- <<< БЛОК ДЛЯ ОТОБРАЖЕНИЯ СОСТАВА >>> -->
        {% if product.composition %}
        <div class="product-composition">
            <h3>Состав</h3>
            <p>{{ product.composition }}</p>
        </div>
        {% endif %}

        <h3>Описание</h3>
        <p class="product-description">{{ product.description }}</p>
    </div>

    <div class="sticky-footer">
        <button class="btn-add-cart" onclick="addToCart(this)">Добавить в корзину</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        function addToCart(button) {
            let cart = JSON.parse(localStorage.getItem('cart')) || {};

            const product = {
                id: {{ product.id }},
                name: "{{ product.name }}",
                price: {{ product.price }},
                image_url: "{{ product.image_url }}",
                size: "{{ product.size }}",
                quantity: 1
            };

            if (cart[product.id]) {
                cart[product.id].quantity += 1;
            } else {
                cart[product.id] = product;
            }

            localStorage.setItem('cart', JSON.stringify(cart));

            button.textContent = 'Добавлено ✓';
            button.classList.add('added');
            button.disabled = true;

            tg.HapticFeedback.notificationOccur('success');

            setTimeout(() => {
                button.textContent = 'Добавить в корзину';
                button.classList.remove('added');
                button.disabled = false;
            }, 1500);
        }
    </script>
</body>
</html>